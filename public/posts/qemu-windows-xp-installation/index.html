<!DOCTYPE html>
<html lang="en-us"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Qemu Windows Xp Installation | Peters Website</title>
<meta property="og:title" content="Qemu Windows Xp Installation | Peters Website" />
<meta name="twitter:title" content="Qemu Windows Xp Installation | Peters Website" />
<meta itemprop="name" content="Qemu Windows Xp Installation | Peters Website" />
<meta name="application-name" content="Qemu Windows Xp Installation | Peters Website" />
<meta property="og:site_name" content="Peter&#39;s blog" />

<meta name="description" content="Random blog posts...some techy and some not">
<meta itemprop="description" content="Random blog posts...some techy and some not" />
<meta property="og:description" content="Random blog posts...some techy and some not" />
<meta name="twitter:description" content="Random blog posts...some techy and some not" />

<meta property="og:locale" content="en-us" />
<meta name="language" content="en-us" />



  <meta itemprop="image" content="https://peterunix.github.io/" />
  <meta property="og:image" content="https://peterunix.github.io/" />
  <meta name="twitter:image" content="https://peterunix.github.io/" />
  <meta name="twitter:image:src" content="https://peterunix.github.io/" />




    
    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-07-22T16:13:48-0700 />
    <meta property="article:published_time" content=2023-07-22T16:13:48-0700 />

    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Qemu Windows Xp Installation",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-07-22",
        "description": "",
        "wordCount":  431 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-07-22",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Peters Website"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.115.4">

    

    <link rel="canonical" href="https://peterunix.github.io/posts/qemu-windows-xp-installation/">
    <link href="/style.min.d16f523c36741e07697791cfe4bcb09b8c92c7034d5cbf85980df65d92a70e97.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://peterunix.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    </head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://peterunix.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        About
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Qemu Windows Xp Installation</h1>
                
                
                <div class="post-meta">
                    <time datetime="2023-07-22T16:13:48-07:00" itemprop="datePublished"> 22 Jul 2023 </time>
                </div>
                
            </header>
            <details class="toc">
                <summary><b>Table of Contents</b></summary>
                <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Dependencies</a>
</li>
<li><a href="#headline-2">Installing Windows XP</a>
</li>
<li><a href="#headline-3">Installing Mouse Drivers</a>
</li>
<li><a href="#headline-4">Installing Ethernet and Display Drivers</a>
</li>
<li><a href="#headline-5">Sharing HOST folder through SMB</a>
</li>
</ul>
</nav>
            </details><div class="page-content">
                
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Dependencies
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<ul>
<li><a href="https://archive.org/download/WinXPProSP3x86/en_windows_xp_professional_with_service_pack_3_x86_cd_vl_x14-73974.iso">Windows XP ISO (archive.org)</a></li>
<li><a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.141-1/">Virtio Floppy Image (fedorapeople.org)</a></li>
<li>qemu</li>
<li>spice-gtk</li>
</ul>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Installing Windows XP
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p><strong>Product Key: MRX3F-47B9T-2487J-KWKMF-RPWBY</strong></p>
<p>
Here&#39;s the shell script to start the installation.
Windows XP will automatically search through the virtio.vfd floppy image when locating the storage drivers.
That floppy image has all the drivers your networking, virtual display, virtio, etc.
<strong>Mouse input and networking won&#39;t work until after you&#39;re logged in</strong>.</p>
<div class="src src-shell">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">  qemu-system-x86_64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -enable-kvm <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -cpu host -smp <span class="m">4</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -m 3G <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -boot d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -cdrom  <span class="s2">&#34;WINDOWSXP.iso&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -fda <span class="s2">&#34;VIRTIO.vfd&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -vga qxl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -spice <span class="nv">port</span><span class="o">=</span>55555,addr<span class="o">=</span>0.0.0.0,disable-ticketing <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -chardev spicevmc,id<span class="o">=</span>vdagent,name<span class="o">=</span>vdagent <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -device virtio-net,netdev<span class="o">=</span>netdevice -netdev user,id<span class="o">=</span>netdevice,smb<span class="o">=</span><span class="nv">$HOME</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -drive <span class="nv">file</span><span class="o">=</span>windowsxp.qcow2,if<span class="o">=</span>virtio,cache<span class="o">=</span>none,aio<span class="o">=</span>native</span></span></code></pre></div>
</div>
<p>
After you run that, use a spice client to connect to the VM. I use spice-gtk.</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Installing Mouse Drivers
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>When you log in, WindowsXP is going to open a wizard that lets you automatically add new hardware.
Use your keyboard to go through these prompts.
This step is important since it will install the drivers to get your mouse working</p>
<p>
After that&#39;s done, poweroff the VM and replace your qemu shell script with the following:</p>
<div class="src src-shell">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">qemu-system-x86_64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-enable-kvm <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-daemonize <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-cpu host -smp <span class="m">4</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-m 3G <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device virtio-net,netdev<span class="o">=</span>netdevice -netdev user,id<span class="o">=</span>netdevice,smb<span class="o">=</span><span class="nv">$HOME</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> 	-fda <span class="s2">&#34;VIRTIO.vfd&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-usb <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device ich9-usb-ehci1,id<span class="o">=</span>usb <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device ich9-usb-uhci1,masterbus<span class="o">=</span>usb.0,firstport<span class="o">=</span>0,multifunction<span class="o">=</span>on <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device ich9-usb-uhci2,masterbus<span class="o">=</span>usb.0,firstport<span class="o">=</span><span class="m">2</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device ich9-usb-uhci3,masterbus<span class="o">=</span>usb.0,firstport<span class="o">=</span><span class="m">4</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-chardev spicevmc,name<span class="o">=</span>usbredir,id<span class="o">=</span>usbredirchardev1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device usb-redir,chardev<span class="o">=</span>usbredirchardev1,id<span class="o">=</span>usbredirdev1 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-chardev spicevmc,name<span class="o">=</span>usbredir,id<span class="o">=</span>usbredirchardev2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device usb-redir,chardev<span class="o">=</span>usbredirchardev2,id<span class="o">=</span>usbredirdev2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-chardev spicevmc,name<span class="o">=</span>usbredir,id<span class="o">=</span>usbredirchardev3 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device usb-redir,chardev<span class="o">=</span>usbredirchardev3,id<span class="o">=</span>usbredirdev3 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-vga qxl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-spice <span class="nv">port</span><span class="o">=</span>55555,disable-ticketing <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-usbdevice tablet <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device virtio-serial <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-chardev spicevmc,id<span class="o">=</span>vdagent,name<span class="o">=</span>vdagent <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-device virtserialport,chardev<span class="o">=</span>vdagent,name<span class="o">=</span>com.redhat.spice.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	-drive <span class="nv">file</span><span class="o">=</span>windowsxp.qcow2,if<span class="o">=</span>virtio,cache<span class="o">=</span>none,aio<span class="o">=</span>native</span></span></code></pre></div>
</div>
<p>
You really only need to remove your WindowsXP iso, but I added more qemu arguemnts to enable USB redirection in spice-gtk.</p>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
Installing Ethernet and Display Drivers
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>Open up a command prompt and type &#34;devmgmt.msc&#34; to open the <strong>Device Manager</strong>.
Under &#34;Unknown Devices&#34;, right click each item to open the properties, then re-install the driver.
Since our VIRTIO.VFD file is still attached, Windows XP will automatically install the drivers for the networking, display, etc.</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
Sharing HOST folder through SMB
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>In the shell snippets above, I have <strong>smb=$HOME</strong> added to expose my home folder as an SMB share on the guest.
Qemu will use a newer version of SMB that Windows XP wont support, causing the whole thing to be broken.
To fix this, we have to edit Qemu&#39;s temporary SMB.CONF file while the Virtual Machine is booting up.</p>
<p>
Add the <strong>sed</strong> command to the bottom of your Qemu shell script.
When Windows XP boots up, you should be able to access your files using this UNC path: <code>\\10.0.2.4\qemu</code></p>
<div class="src src-shell">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">  qemu-system-x86_64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -daemonize...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Fixing SMB</span>
</span></span><span class="line"><span class="cl">  sed -e <span class="s1">&#39;s/\[qemu\]/min protocol = NT1\n\[qemu\]/&#39;</span> -i /tmp/qemu-smb.*/smb.conf</span></span></code></pre></div>
</div>
</div>
</div>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/peterunix" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="index.xml" target="_blank" rel="noopener noreferrer me"
    title="Rss">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        Â© 2023 Peter T.
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noreferrer noopener">Hugo blog awesome</a>
        theme on
        <a href="https://gohugo.io" target="_blank" rel="noreferrer noopener">Hugo</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    




    
    
        
    

    
    
        
    



    
    <script src="https://peterunix.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js" integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30&#43;lSNuSkl4QXuNyy8="></script>

    

</body>
</html>

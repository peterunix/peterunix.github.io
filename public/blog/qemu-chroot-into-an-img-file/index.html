<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <title>Qemu Chroot Into an Img File</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/gtd.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>
</head>
<body>
  
<main>
  <h1>Qemu Chroot Into an Img File</h1>

  <nav class="toc">
    <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Preface</a>
</li>
<li><a href="#headline-2">Mounting the image</a>
</li>
<li><a href="#headline-3">Conclusion</a>
</li>
</ul>
</nav>
  </nav> 

  <article>
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Preface
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Full disk images contain the bootloader and partition table.
To mount an image file, view the contents of the file, then specify a <em>byte offset</em> that points to the beginning of our linux root partition.
We&#39;re essentially telling our mount command start reading the IMG file from <em>somanybytes</em> from the start.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Mounting the image
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>Run <em>fdisk -l file.img</em>.</p>
<p>
Here, you want to make note of the value under the &#34;START&#34; column.
Basing it off the size of the paritions, I can assume my root partition is the one that starts at 532480 bytes in.</p>
<div class="src src-shell">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Units: sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Device                                    Boot  Start     End Sectors  Size Id Type
</span></span><span style="display:flex;"><span>2021-05-07-raspios-buster-armhf-lite.img1        <span style="color:#ae81ff">8192</span>  <span style="color:#ae81ff">532479</span>  <span style="color:#ae81ff">524288</span>  256M  c W95 FAT32 <span style="color:#f92672">(</span>LBA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>2021-05-07-raspios-buster-armhf-lite.img2      <span style="color:#ae81ff">532480</span> <span style="color:#ae81ff">3661823</span> <span style="color:#ae81ff">3129344</span>  1.5G <span style="color:#ae81ff">83</span> Linux</span></span></code></pre></div>
</div>
<p>
Now I have to multiple the start sector (532480) by the sector size (512).
I&#39;m using the bash to do the multiplication from within my mount command.</p>
<div class="src src-shell">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>mount -o loop,offset<span style="color:#f92672">=</span><span style="color:#66d9ef">$((</span><span style="color:#ae81ff">512</span><span style="color:#f92672">*</span><span style="color:#ae81ff">532480</span><span style="color:#66d9ef">))</span>,rw ~/2021-05-07-raspios-buster-armhf-lite.img /mnt</span></span></code></pre></div>
</div>
<p>
<strong>-o</strong> Pass options to mount</p>
<p>
<strong>loop</strong> Creates a psuedo block device to mount the image file to</p>
<p>
<strong>offset=$((512*532480))</strong> Sets the offset to the sum of 512*startSector</p>
<p>
<strong>rw</strong> Enables reading and writing to the mountpoint</p>
</div>
</div>
<div id="outline-container-headline-3" class="outline-2">
<h2 id="headline-3">
Conclusion
</h2>
<div id="outline-text-headline-3" class="outline-text-2">
<p>The drive should be mounted.
If your root partition isn&#39;t the last partition, you&#39;ll want to google how to specify the start/end byte offset for <em>mount</em>.</p>
</div>
</div>

  </article>
</main>

</body>
</html>

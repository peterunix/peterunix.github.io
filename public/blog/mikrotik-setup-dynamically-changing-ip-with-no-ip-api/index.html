<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
  <title>Mikrotik Setup Dynamically Changing IP With No-IP Api</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/gtd.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/themes/prism-tomorrow.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.27.0/prism.min.js"></script>
</head>
<body>
  
<main>
  <h1>Mikrotik Setup Dynamically Changing IP With No-IP Api</h1>

  <nav class="toc">
    <nav id="TableOfContents">
<ul>
<li><a href="#headline-1">Code</a>
</li>
<li><a href="#headline-2">Running and Scheduling a Job</a>
</li>
</ul>
</nav>
  </nav> 

  <article>
    
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Code
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>Use the <strong>System&gt;Scripts</strong> page and create a new script with this code. Change the variables under the <strong>Script Settings</strong> block. Also, to make things easier, set the name of the script to &#34;NoIP&#34;</p>
<p>
<a href="https://forum.mikrotik.com/viewtopic.php?t=120347">Source Page</a></p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">##############Script Settings##################</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:local NOIPUser <span style="color:#e6db74">&#34;USERNAME&#34;</span>
</span></span><span style="display:flex;"><span>:local NOIPPass <span style="color:#e6db74">&#34;PASSWORD&#34;</span>
</span></span><span style="display:flex;"><span>:local WANInter <span style="color:#e6db74">&#34;ether1&#34;</span>
</span></span><span style="display:flex;"><span>:local NOIPDomain <span style="color:#e6db74">&#34;NO-IP.DDNS.NET&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">###############################################</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get the current IP on the interface</span>
</span></span><span style="display:flex;"><span>:local currentIP <span style="color:#f92672">[</span>/ip address get <span style="color:#f92672">[</span>find interface<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$WANInter<span style="color:#e6db74">&#34;</span> disabled<span style="color:#f92672">=</span>no<span style="color:#f92672">]</span> address<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Strip the net mask off the IP address</span>
</span></span><span style="display:flex;"><span>   :for i from<span style="color:#f92672">=(</span> <span style="color:#f92672">[</span>:len $currentIP<span style="color:#f92672">]</span> - 1<span style="color:#f92672">)</span> to<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">do</span><span style="color:#f92672">={</span>
</span></span><span style="display:flex;"><span>       :if <span style="color:#f92672">(</span> <span style="color:#f92672">[</span>:pick $currentIP $i<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">do</span><span style="color:#f92672">={</span>
</span></span><span style="display:flex;"><span>           :set currentIP <span style="color:#f92672">[</span>:pick $currentIP <span style="color:#ae81ff">0</span> $i<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>       <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>:if <span style="color:#f92672">([</span>:resolve $NOIPDomain<span style="color:#f92672">]</span> !<span style="color:#f92672">=</span> $currentIP<span style="color:#f92672">)</span> <span style="color:#66d9ef">do</span><span style="color:#f92672">={</span>
</span></span><span style="display:flex;"><span>      /tool fetch mode<span style="color:#f92672">=</span>http user<span style="color:#f92672">=</span>$NOIPUser password<span style="color:#f92672">=</span>$NOIPPass url<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://dynupdate.no-ip.com/nic/update\3Fhostname=</span>$NOIPDomain<span style="color:#e6db74">&amp;myip=</span>$currentIP<span style="color:#e6db74">&#34;</span> keep-result<span style="color:#f92672">=</span>no
</span></span><span style="display:flex;"><span>      :log info <span style="color:#e6db74">&#34;NO-IP Update: </span>$NOIPDomain<span style="color:#e6db74"> - </span>$currentIP<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
Running and Scheduling a Job
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>You can run the script a single time with this command:</p>
<div class="src src-bash">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># &#34;NoIP&#34; is the name I set for the script</span>
</span></span><span style="display:flex;"><span>/system/script/run NoIP</span></span></code></pre></div>
</div>
<p>
I&#39;d suggest scheduling the script to run every few minutes.</p>
<div class="src src-text">
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># Again, the name I gave my script was &#34;NoIP&#34;
</span></span><span style="display:flex;"><span>/system/scheduler/ add name=NoIPCheck interval=3m on-event=NoIP</span></span></code></pre></div>
</div>
</div>
</div>

  </article>
</main>

</body>
</html>
